# built-in snippet for OceanBase MySQL compatible mode
- name: oceanbase mysql query unit list
  dialect_type: OB_MYSQL
  tags: [ 'dba','oceanbase' ]
  type: DQL
  min_version: 4.0.0
  max_version: ~
  description: 'Query unit list for OceanBase MySQL compatible mode'
  prefix: query_unit_list
  body: |
    SELECT
      SVR_IP,
      SVR_PORT,
      UNIT_ID,
      TENANT_ID,
      ZONE,
      ZONE_TYPE,
      REGION,
      MAX_CPU,
      MIN_CPU,
      round(memory_size / 1024 / 1024 / 1024) memory_size_gb,
      MAX_IOPS,
      MIN_IOPS,
      IOPS_WEIGHT,
      round(log_disk_size / 1024 / 1024 / 1024) log_disk_size_gb,
      round(LOG_DISK_IN_USE / 1024 / 1024 / 1024) LOG_DISK_IN_USE_GB,
      round(DATA_DISK_IN_USE / 1024 / 1024 / 1024) DATA_DISK_IN_USE_GB,
      STATUS,
      CREATE_TIME
    FROM
      oceanbase.GV\$OB_UNITS;
- name: oceanbase mysql query cluster info
  dialect_type: OB_MYSQL
  tags: [ 'dba','oceanbase' ]
  type: DQL
  min_version: 4.0.0
  max_version: ~
  description: 'Query OceanBase cluster information'
  prefix: query_cluster_info
  body: |
    SELECT NAME, VALUE 
    FROM 
      oceanbase.GV\$OB_PARAMETERS 
    WHERE 
      NAME IN ('cluster', 'cluster_id');
- name: oceanbase mysql query major compaction
  dialect_type: OB_MYSQL
  tags: [ 'dba','oceanbase' ]
  type: DQL
  min_version: 4.0.0
  max_version: ~
  description: 'Query OceanBase cluster information'
  prefix: query_major_compaction
  body: |
    SELECT
      FROZEN_SCN,
      FROZEN_TIME,
      GLOBAL_BROADCAST_SCN,
      LAST_SCN,
      LAST_FINISH_TIME,
      START_TIME,
      STATUS,
      IS_ERROR,
      IS_SUSPENDED,
      INFO
    FROM
      oceanbase.DBA_OB_MAJOR_COMPACTION;
- name: oceanbase mysql query tenant information
  dialect_type: OB_MYSQL
  tags: [ 'dba','oceanbase' ]
  type: DQL
  min_version: 4.0.0
  max_version: ~
  description: 'Query OceanBase tenant information'
  prefix: query_tenant_information
  body: |
    SELECT
      TENANT_ID,
      TENANT_NAME,
      TENANT_TYPE,
      PRIMARY_ZONE,
      LOCALITY,
      COMPATIBILITY_MODE,
      STATUS,
      LOCKED,
      IN_RECYCLEBIN,
      TIMESTAMPDIFF(SECOND,CREATE_TIME,NOW()) AS EXIST_SECONDS
    FROM
      oceanbase.DBA_OB_TENANTS;
